"use strict";
class FairSocket {
    stompClient;
    userData = new UserData();
    state = Vue.reactive({
        connected: false,
        connectionRequested: false,
    });
    constructor() {
        this.stompClient = StompJs.Stomp.over(() => new SockJS('https://fair.kaliburg.de/fairsocket'));
        for (let k of [
            'onChangeState',
            'onConnect',
            'onDisconnect',
            'onStompError',
            'onUnhandledFrame',
            'onUnhandledMessage',
            'onUnhandledReceipt',
            'onWebSocketClose',
            'onWebSocketError',
        ]) {
            // just logging everything
            this.stompClient[k] = (...a) => {
                console.warn(k, ...a);
                this[k]?.(...a);
            };
        }
        window.addEventListener('onbeforeunload', () => this.disconnect());
    }
    _resolveOnConnected = [];
    connect() {
        this.state.connectionRequested = true;
        return new Promise(resolve => {
            if (this.stompClient.connected) {
                resolve();
            }
            else {
                this._resolveOnConnected.push(resolve);
                this.stompClient.connect({}, this.stompClient.onConnect);
            }
        });
    }
    disconnect() {
        this.stompClient.disconnect();
    }
    onConnect() {
        this.state.connectionRequested = false;
        this.state.connected = true;
        this._resolveOnConnected.map(e => e());
    }
    send(destination, data, number) {
        if (destination.includes('$')) {
            if (number == undefined)
                throw new Error('bad usage');
            destination = `${destination.split('$')[0]}${number}`;
        }
        else {
            if (number != undefined)
                throw new Error('bad usage');
        }
        this.stompClient.send(destination, {}, JSON.stringify(data));
    }
    subscribe(destination, listener, request, number) {
        if (destination.includes('$')) {
            if (number == undefined)
                throw new Error('bad usage');
            destination = `${destination.split('$')[0]}${number}`;
        }
        else {
            if (number != undefined)
                throw new Error('bad usage');
        }
        return this.stompClient.subscribe(destination, (message) => {
            let data = JSON.parse(message.body || 'null');
            console.warn(destination, data, message);
            listener(data);
        }, request);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RvbXAuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvc3RvbXAudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQWdFQSxNQUFNLFVBQVU7SUFDZixXQUFXLENBQXVCO0lBQ2xDLFFBQVEsR0FBRyxJQUFJLFFBQVEsRUFBRSxDQUFDO0lBQzFCLEtBQUssR0FBRyxHQUFHLENBQUMsUUFBUSxDQUFDO1FBQ3BCLFNBQVMsRUFBRSxLQUFLO1FBQ2hCLG1CQUFtQixFQUFFLEtBQUs7S0FDMUIsQ0FBQyxDQUFDO0lBQ0g7UUFDQyxJQUFJLENBQUMsV0FBVyxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksTUFBTSxDQUFDLHFDQUFxQyxDQUFDLENBQUMsQ0FBQztRQUMvRixLQUFLLElBQUksQ0FBQyxJQUFJO1lBQ2IsZUFBZTtZQUNmLFdBQVc7WUFDWCxjQUFjO1lBQ2QsY0FBYztZQUNkLGtCQUFrQjtZQUNsQixvQkFBb0I7WUFDcEIsb0JBQW9CO1lBQ3BCLGtCQUFrQjtZQUNsQixrQkFBa0I7U0FDVCxFQUFFO1lBQ1gsMEJBQTBCO1lBQzFCLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFO2dCQUM5QixPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO2dCQUNyQixJQUFZLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQzFCLENBQUMsQ0FBQTtTQUNEO1FBQ0QsTUFBTSxDQUFDLGdCQUFnQixDQUFDLGdCQUFnQixFQUFFLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQyxDQUFDO0lBQ3BFLENBQUM7SUFDRCxtQkFBbUIsR0FBbUIsRUFBRSxDQUFDO0lBQ3pDLE9BQU87UUFDTixJQUFJLENBQUMsS0FBSyxDQUFDLG1CQUFtQixHQUFHLElBQUksQ0FBQztRQUN0QyxPQUFPLElBQUksT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFFO1lBQzVCLElBQUksSUFBSSxDQUFDLFdBQVcsQ0FBQyxTQUFTLEVBQUU7Z0JBQy9CLE9BQU8sRUFBRSxDQUFDO2FBQ1Y7aUJBQU07Z0JBQ04sSUFBSSxDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztnQkFDdkMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxXQUFXLENBQUMsU0FBUyxDQUFDLENBQUM7YUFDekQ7UUFDRixDQUFDLENBQUMsQ0FBQztJQUNKLENBQUM7SUFDRCxVQUFVO1FBQ1QsSUFBSSxDQUFDLFdBQVcsQ0FBQyxVQUFVLEVBQUUsQ0FBQztJQUMvQixDQUFDO0lBQ0QsU0FBUztRQUNSLElBQUksQ0FBQyxLQUFLLENBQUMsbUJBQW1CLEdBQUcsS0FBSyxDQUFDO1FBQ3ZDLElBQUksQ0FBQyxLQUFLLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQztRQUM1QixJQUFJLENBQUMsbUJBQW1CLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUN4QyxDQUFDO0lBSUQsSUFBSSxDQUEyQyxXQUFjLEVBQUUsSUFBaUMsRUFBRSxNQUFlO1FBQ2hILElBQUksV0FBVyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsRUFBRTtZQUM5QixJQUFJLE1BQU0sSUFBSSxTQUFTO2dCQUFFLE1BQU0sSUFBSSxLQUFLLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDdEQsV0FBVyxHQUFHLEdBQUcsV0FBVyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxNQUFNLEVBQVMsQ0FBQztTQUM3RDthQUFNO1lBQ04sSUFBSSxNQUFNLElBQUksU0FBUztnQkFBRSxNQUFNLElBQUksS0FBSyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1NBQ3REO1FBQ0QsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLEVBQUUsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7SUFDOUQsQ0FBQztJQUdELFNBQVMsQ0FBaUQsV0FBYyxFQUFFLFFBQTJELEVBQUUsT0FBdUIsRUFBRSxNQUFlO1FBQzlLLElBQUksV0FBVyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsRUFBRTtZQUM5QixJQUFJLE1BQU0sSUFBSSxTQUFTO2dCQUFFLE1BQU0sSUFBSSxLQUFLLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDdEQsV0FBVyxHQUFHLEdBQUcsV0FBVyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxNQUFNLEVBQVMsQ0FBQztTQUM3RDthQUFNO1lBQ04sSUFBSSxNQUFNLElBQUksU0FBUztnQkFBRSxNQUFNLElBQUksS0FBSyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1NBQ3REO1FBQ0QsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLFNBQVMsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxPQUFPLEVBQUUsRUFBRTtZQUMxRCxJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLElBQUksTUFBTSxDQUFDLENBQUM7WUFDOUMsT0FBTyxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsSUFBSSxFQUFFLE9BQU8sQ0FBQyxDQUFDO1lBQ3pDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNoQixDQUFDLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDYixDQUFDO0NBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJcclxudHlwZSBEZWNpbWFsU3RyaW5nID0gc3RyaW5nICYgeyBfPzogJ0RlY2ltYWxTdHJpbmcnIH07XHJcblxyXG5pbnRlcmZhY2UgU29ja2V0TGFkZGVyRXZlbnQge1xyXG5cdGV2ZW50VHlwZTogc3RyaW5nLFxyXG5cdGFjY291bnRJZDogYWNjb3VudElkLFxyXG59XHJcbmludGVyZmFjZSBTb2NrZXRDaGF0TWVzc2FnZSB7XHJcblx0dXNlcm5hbWU6IHN0cmluZyxcclxuXHRhY2NvdW50SWQ6IGFjY291bnRJZCxcclxuXHRtZXNzYWdlOiBzdHJpbmcsXHJcblx0dGltZUNyZWF0ZWQ6IHN0cmluZyxcclxuXHR0aW1lc0Fzc2hvbGU6IG51bWJlcixcclxufVxyXG5pbnRlcmZhY2UgRmFpclNvY2tldFNlbmRSZXF1ZXN0TWFwIHtcclxuXHQnL2FwcC9hY2NvdW50L2xvZ2luJzogeyB1dWlkOiB1dWlkIH0sXHJcblx0Jy9hcHAvYWNjb3VudC9uYW1lJzogeyB1dWlkOiB1dWlkLCBjb250ZW50OiBzdHJpbmcgJiB7IF8/OiAnbmV3VXNlcm5hbWUnIH0gfSxcclxuXHQnL2FwcC9jaGF0L2luaXQvJGxhZGRlck51bSc6IHsgdXVpZDogdXVpZCB9LFxyXG5cdCcvYXBwL2NoYXQvcG9zdC8kY3VycmVudENoYXROdW1iZXInOiB7IHV1aWQ6IHV1aWQsIGNvbnRlbnQ6IHN0cmluZyAmIHsgXz86ICdtZXNzYWdlJyB9IH0sXHJcblx0Jy9hcHAvaW5mbyc6IHsgdXVpZDogdXVpZCB9LFxyXG5cdCcvYXBwL2xhZGRlci9pbml0LyRsYWRkZXJOdW0nOiB7IHV1aWQ6IHV1aWQgfSxcclxuXHQnL2FwcC9sYWRkZXIvcG9zdC9hc3Nob2xlJzogeyB1dWlkOiB1dWlkIH0sXHJcblx0Jy9hcHAvbGFkZGVyL3Bvc3QvYXV0by1wcm9tb3RlJzogeyB1dWlkOiB1dWlkIH0sXHJcblx0Jy9hcHAvbGFkZGVyL3Bvc3QvYmlhcyc6IHsgdXVpZDogdXVpZCB9LFxyXG5cdCcvYXBwL2xhZGRlci9wb3N0L211bHRpJzogeyB1dWlkOiB1dWlkIH0sXHJcblx0Jy9hcHAvbGFkZGVyL3Bvc3QvcHJvbW90ZSc6IHsgdXVpZDogdXVpZCB9LFxyXG5cdCcvYXBwL2xhZGRlci9wb3N0L3ZpbmVnYXInOiB7IHV1aWQ6IHV1aWQgfSxcclxufVxyXG5cclxuaW50ZXJmYWNlIEZhaXJTb2NrZXRTdWJzY3JpYmVSZXNwb25zZU1hcCB7XHJcblx0Jy90b3BpYy9jaGF0LyRsYWRkZXJOdW0nOiBTb2NrZXRDaGF0TWVzc2FnZSxcclxuXHQnL3RvcGljL2xhZGRlci8kbGFkZGVyTnVtJzogeyBldmVudHM6IFNvY2tldExhZGRlckV2ZW50W10sIHNlY29uZHNQYXNzZWQ6IG51bWJlciB9LFxyXG5cdCcvdXNlci9xdWV1ZS9hY2NvdW50L2xvZ2luJzoge1xyXG5cdFx0c3RhdHVzOiAnT0snIHwgJ0NSRUFURUQnIHwgJz8nLFxyXG5cdFx0Y29udGVudD86IHtcclxuXHRcdFx0dXVpZDogdXVpZCwgYWNjb3VudElkOiBudW1iZXIsIGhpZ2hlc3RDdXJyZW50TGFkZGVyOiBudW1iZXJcclxuXHRcdH1cclxuXHR9LFxyXG5cdCcvdXNlci9xdWV1ZS9jaGF0Lyc6IHtcclxuXHRcdHN0YXR1czogJ09LJyB8ICc/JyxcclxuXHRcdGNvbnRlbnQ/OiB7XHJcblx0XHRcdGN1cnJlbnRDaGF0TnVtYmVyOiBudW1iZXIsXHJcblx0XHRcdG1lc3NhZ2VzOiBTb2NrZXRDaGF0TWVzc2FnZVtdLFxyXG5cdFx0fVxyXG5cdH0sXHJcblx0Jy91c2VyL3F1ZXVlL2luZm8nOiB7XHJcblx0XHRhc3Nob2xlTGFkZGVyOiBudW1iZXIsXHJcblx0XHRhc3Nob2xlVGFnczogc3RyaW5nW10sXHJcblx0XHRhdXRvUHJvbW90ZUxhZGRlcjogbnVtYmVyLFxyXG5cdFx0YmFzZUdyYXBlc05lZWRlZFRvQXV0b1Byb21vdGU6IERlY2ltYWxTdHJpbmcsXHJcblx0XHRiYXNlVmluZWdhck5lZWRlZFRvVGhyb3c6IERlY2ltYWxTdHJpbmcsXHJcblx0XHRtYW51YWxQcm9tb3RlV2FpdFRpbWU6IG51bWJlcixcclxuXHRcdG1pbmltdW1QZW9wbGVGb3JQcm9tb3RlOiBudW1iZXIsXHJcblx0XHRwb2ludHNGb3JQcm9tb3RlOiBEZWNpbWFsU3RyaW5nLFxyXG5cdH0sXHJcblx0Jy91c2VyL3F1ZXVlL2xhZGRlci8nOiB7XHJcblx0XHRzdGF0dXM6ICdPSycgfCAnPycsXHJcblx0XHRjb250ZW50PzogdW5rbm93biAmIHsgXz86ICdMYWRkZXJEYXRhJyB9LFxyXG5cdH0sXHJcblx0Jy91c2VyL3F1ZXVlL2xhZGRlci91cGRhdGVzJzoge1xyXG5cdFx0ZXZlbnRzOiBTb2NrZXRMYWRkZXJFdmVudFtdLFxyXG5cdH0sXHJcbn1cclxuXHJcbmNsYXNzIEZhaXJTb2NrZXQge1xyXG5cdHN0b21wQ2xpZW50OiBTdG9tcEpzLkNvbXBhdENsaWVudDtcclxuXHR1c2VyRGF0YSA9IG5ldyBVc2VyRGF0YSgpO1xyXG5cdHN0YXRlID0gVnVlLnJlYWN0aXZlKHtcclxuXHRcdGNvbm5lY3RlZDogZmFsc2UsXHJcblx0XHRjb25uZWN0aW9uUmVxdWVzdGVkOiBmYWxzZSxcclxuXHR9KTtcclxuXHRjb25zdHJ1Y3RvcigpIHtcclxuXHRcdHRoaXMuc3RvbXBDbGllbnQgPSBTdG9tcEpzLlN0b21wLm92ZXIoKCkgPT4gbmV3IFNvY2tKUygnaHR0cHM6Ly9mYWlyLmthbGlidXJnLmRlL2ZhaXJzb2NrZXQnKSk7XHJcblx0XHRmb3IgKGxldCBrIG9mIFtcclxuXHRcdFx0J29uQ2hhbmdlU3RhdGUnLFxyXG5cdFx0XHQnb25Db25uZWN0JyxcclxuXHRcdFx0J29uRGlzY29ubmVjdCcsXHJcblx0XHRcdCdvblN0b21wRXJyb3InLFxyXG5cdFx0XHQnb25VbmhhbmRsZWRGcmFtZScsXHJcblx0XHRcdCdvblVuaGFuZGxlZE1lc3NhZ2UnLFxyXG5cdFx0XHQnb25VbmhhbmRsZWRSZWNlaXB0JyxcclxuXHRcdFx0J29uV2ViU29ja2V0Q2xvc2UnLFxyXG5cdFx0XHQnb25XZWJTb2NrZXRFcnJvcicsXHJcblx0XHRdIGFzIGNvbnN0KSB7XHJcblx0XHRcdC8vIGp1c3QgbG9nZ2luZyBldmVyeXRoaW5nXHJcblx0XHRcdHRoaXMuc3RvbXBDbGllbnRba10gPSAoLi4uYSkgPT4ge1xyXG5cdFx0XHRcdGNvbnNvbGUud2FybihrLCAuLi5hKTtcclxuXHRcdFx0XHQodGhpcyBhcyBhbnkpW2tdPy4oLi4uYSk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdvbmJlZm9yZXVubG9hZCcsICgpID0+IHRoaXMuZGlzY29ubmVjdCgpKTtcclxuXHR9XHJcblx0X3Jlc29sdmVPbkNvbm5lY3RlZDogKCgpID0+IHZvaWQpW10gPSBbXTtcclxuXHRjb25uZWN0KCk6IFByb21pc2U8dm9pZD4ge1xyXG5cdFx0dGhpcy5zdGF0ZS5jb25uZWN0aW9uUmVxdWVzdGVkID0gdHJ1ZTtcclxuXHRcdHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcclxuXHRcdFx0aWYgKHRoaXMuc3RvbXBDbGllbnQuY29ubmVjdGVkKSB7XHJcblx0XHRcdFx0cmVzb2x2ZSgpO1xyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdHRoaXMuX3Jlc29sdmVPbkNvbm5lY3RlZC5wdXNoKHJlc29sdmUpO1xyXG5cdFx0XHRcdHRoaXMuc3RvbXBDbGllbnQuY29ubmVjdCh7fSwgdGhpcy5zdG9tcENsaWVudC5vbkNvbm5lY3QpO1xyXG5cdFx0XHR9XHJcblx0XHR9KTtcclxuXHR9XHJcblx0ZGlzY29ubmVjdCgpIHtcclxuXHRcdHRoaXMuc3RvbXBDbGllbnQuZGlzY29ubmVjdCgpO1xyXG5cdH1cclxuXHRvbkNvbm5lY3QoKSB7XHJcblx0XHR0aGlzLnN0YXRlLmNvbm5lY3Rpb25SZXF1ZXN0ZWQgPSBmYWxzZTtcclxuXHRcdHRoaXMuc3RhdGUuY29ubmVjdGVkID0gdHJ1ZTtcclxuXHRcdHRoaXMuX3Jlc29sdmVPbkNvbm5lY3RlZC5tYXAoZSA9PiBlKCkpO1xyXG5cdH1cclxuXHJcblx0c2VuZDxLIGV4dGVuZHMgRXh0cmFjdDxrZXlvZiBGYWlyU29ja2V0U2VuZFJlcXVlc3RNYXAsIGAke3N0cmluZ30kJHtzdHJpbmd9YD4+KGRlc3RpbmF0aW9uOiBLLCBkYXRhOiBGYWlyU29ja2V0U2VuZFJlcXVlc3RNYXBbS10sIG51bWJlcjogbnVtYmVyKTogdm9pZDtcclxuXHRzZW5kPEsgZXh0ZW5kcyBFeGNsdWRlPGtleW9mIEZhaXJTb2NrZXRTZW5kUmVxdWVzdE1hcCwgYCR7c3RyaW5nfSQke3N0cmluZ31gPj4oZGVzdGluYXRpb246IEssIGRhdGE6IEZhaXJTb2NrZXRTZW5kUmVxdWVzdE1hcFtLXSk6IHZvaWQ7XHJcblx0c2VuZDxLIGV4dGVuZHMga2V5b2YgRmFpclNvY2tldFNlbmRSZXF1ZXN0TWFwPihkZXN0aW5hdGlvbjogSywgZGF0YTogRmFpclNvY2tldFNlbmRSZXF1ZXN0TWFwW0tdLCBudW1iZXI/OiBudW1iZXIpIHtcclxuXHRcdGlmIChkZXN0aW5hdGlvbi5pbmNsdWRlcygnJCcpKSB7XHJcblx0XHRcdGlmIChudW1iZXIgPT0gdW5kZWZpbmVkKSB0aHJvdyBuZXcgRXJyb3IoJ2JhZCB1c2FnZScpO1xyXG5cdFx0XHRkZXN0aW5hdGlvbiA9IGAke2Rlc3RpbmF0aW9uLnNwbGl0KCckJylbMF19JHtudW1iZXJ9YCBhcyBhbnk7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHRpZiAobnVtYmVyICE9IHVuZGVmaW5lZCkgdGhyb3cgbmV3IEVycm9yKCdiYWQgdXNhZ2UnKTtcclxuXHRcdH1cclxuXHRcdHRoaXMuc3RvbXBDbGllbnQuc2VuZChkZXN0aW5hdGlvbiwge30sIEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcclxuXHR9XHJcblx0c3Vic2NyaWJlPEsgZXh0ZW5kcyBFeHRyYWN0PGtleW9mIEZhaXJTb2NrZXRTdWJzY3JpYmVSZXNwb25zZU1hcCwgYCR7c3RyaW5nfSQke3N0cmluZ31gPj4oZGVzdGluYXRpb246IEssIGxpc3RlbmVyOiAoZGF0YTogRmFpclNvY2tldFN1YnNjcmliZVJlc3BvbnNlTWFwW0tdKSA9PiB2b2lkLCByZXF1ZXN0OiB7IHV1aWQ6IHV1aWQgfSwgbnVtYmVyOiBudW1iZXIpOiBTdG9tcEpzLlN0b21wU3Vic2NyaXB0aW9uO1xyXG5cdHN1YnNjcmliZTxLIGV4dGVuZHMgRXhjbHVkZTxrZXlvZiBGYWlyU29ja2V0U3Vic2NyaWJlUmVzcG9uc2VNYXAsIGAke3N0cmluZ30kJHtzdHJpbmd9YD4+KGRlc3RpbmF0aW9uOiBLLCBsaXN0ZW5lcjogKGRhdGE6IEZhaXJTb2NrZXRTdWJzY3JpYmVSZXNwb25zZU1hcFtLXSkgPT4gdm9pZCwgcmVxdWVzdDogeyB1dWlkOiB1dWlkIH0pOiBTdG9tcEpzLlN0b21wU3Vic2NyaXB0aW9uO1xyXG5cdHN1YnNjcmliZTxLIGV4dGVuZHMga2V5b2YgRmFpclNvY2tldFN1YnNjcmliZVJlc3BvbnNlTWFwPihkZXN0aW5hdGlvbjogSywgbGlzdGVuZXI6IChkYXRhOiBGYWlyU29ja2V0U3Vic2NyaWJlUmVzcG9uc2VNYXBbS10pID0+IHZvaWQsIHJlcXVlc3Q6IHsgdXVpZDogdXVpZCB9LCBudW1iZXI/OiBudW1iZXIpIHtcclxuXHRcdGlmIChkZXN0aW5hdGlvbi5pbmNsdWRlcygnJCcpKSB7XHJcblx0XHRcdGlmIChudW1iZXIgPT0gdW5kZWZpbmVkKSB0aHJvdyBuZXcgRXJyb3IoJ2JhZCB1c2FnZScpO1xyXG5cdFx0XHRkZXN0aW5hdGlvbiA9IGAke2Rlc3RpbmF0aW9uLnNwbGl0KCckJylbMF19JHtudW1iZXJ9YCBhcyBhbnk7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHRpZiAobnVtYmVyICE9IHVuZGVmaW5lZCkgdGhyb3cgbmV3IEVycm9yKCdiYWQgdXNhZ2UnKTtcclxuXHRcdH1cclxuXHRcdHJldHVybiB0aGlzLnN0b21wQ2xpZW50LnN1YnNjcmliZShkZXN0aW5hdGlvbiwgKG1lc3NhZ2UpID0+IHtcclxuXHRcdFx0bGV0IGRhdGEgPSBKU09OLnBhcnNlKG1lc3NhZ2UuYm9keSB8fCAnbnVsbCcpO1xyXG5cdFx0XHRjb25zb2xlLndhcm4oZGVzdGluYXRpb24sIGRhdGEsIG1lc3NhZ2UpO1xyXG5cdFx0XHRsaXN0ZW5lcihkYXRhKTtcclxuXHRcdH0sIHJlcXVlc3QpO1xyXG5cdH1cclxufVxyXG4iXX0=